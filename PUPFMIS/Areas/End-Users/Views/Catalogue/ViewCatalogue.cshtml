@model IEnumerable<PUPFMIS.Models.CatalogueVM>

@{
    ViewBag.Title = "Catalogue";
    ViewBag.Description = "Items and Services";
    Layout = "~/Views/Shared/_BodyLayout.cshtml";
}

@section BreadCrumb {
    <ol class="breadcrumb float-sm-right">
        <li class="breadcrumb-item"><a href="/"><i class="fa fa-dashboard"></i>@Html.ActionLink("PUP-FM Portal", "index", "Home")</a></li>
        <li class="breadcrumb-item">@Html.ActionLink("Dashboard", "dashboard", "ProjectPlans", new { area = "end-users" }, null)</li>
        <li class="breadcrumb-item">Catalogue</li>
    </ol>
}

@section Header {
    <div class="col-md-12 text-right">
        <h1 class="card-title"><i class="fa fa-bookmark"></i> Items and Services Catalogue</h1>
    </div>
}

<div class="row">
    <div class="col-sm-12">
        <div id="accordion">
            <div class="card card-primary">
                <div class="card-header" id="heading_search">
                    <h3 class="card-title">
                        <button type="button" class="btn btn-link collapsed text-white m-0 p-0" data-toggle="collapse" data-target="#collapse_search" aria-expanded="false" aria-controls="#collapse_search">
                            Search Items
                        </button>
                    </h3>
                </div>
                <div id="collapse_search" class="card-body collapse" aria-labelledby="#heading_search" data-parent="#accordion">
                    <div class="row">
                        <div class="col-sm-1"></div>
                        <div class="col-sm-12">
                            @using (Html.BeginForm("view-catalogue-search", "Catalogue", new { Area = "end-users" }, FormMethod.Post))
                            {
                                @Html.AntiForgeryToken()
                                <div class="form-group">
                                    @Html.Label("Category", htmlAttributes: new { @class = "control-label" })
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><i class="fa fa-bookmark"></i></span>
                                        </div>
                                        @Html.DropDownList("Categories", null, "--- SELECT CATEGORY ---", htmlAttributes: new { @class = "form-control form-control-sm select2", style = "font-size:100%; width:95%;" })
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.Label("Item Type", htmlAttributes: new { @class = "control-label" })
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><i class="fa fa-bookmark"></i></span>
                                        </div>
                                        @Html.DropDownList("ItemTypes", null, "--- SELECT ITEM TYPE ---", htmlAttributes: new { @class = "form-control form-control-sm select2", style = "font-size:100%; width:95%;" })
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.Label("Item Name", htmlAttributes: new { @class = "control-label" })
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><i class="fa fa-bookmark"></i></span>
                                        </div>
                                        @Html.TextBox("SearchByItemName", null, htmlAttributes: new { @class = "form-control form-control-sm" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div style="text-align: right;">
                                            <button type="submit" class="btn btn-sm btn-primary"> <i class="fa fa-search"></i> Search Items</button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="col-sm-1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<hr />
<div class="row">
    <div class="col-sm-12">
        @if (Model.Count() == 0)
        {
            <div class="row">
                <div class="col-sm-12">
                    <h3>No items found.</h3>
                </div>
            </div>
        }
        else
        {
            <div class="card-body table-responsive p-sm-0">
                <table class="table table-striped table-hover" id="items">
                    <thead>
                        <tr>
                            <th style="text-align:center; vertical-align:middle" width="25%">Image</th>
                            <th style="text-align:center; vertical-align:middle" width="75%">Item Full Specification</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderBy(d => d.ItemName))
                        {
                            <tr>
                                <td style="text-align:center; vertical-align:middle">
                                    @if (item.ItemImage != null)
                                    {
                                        var base64 = Convert.ToBase64String(item.ItemImage);
                                        var imgsrc = string.Format("data:image/jpg;base64,{0}", base64);
                                        <img src='@imgsrc' style="max-width:150px; max-height:150px;" />
                                    }
                                    else
                                    {
                                        <img src="@Url.Content("~/Content/imgs/PUPLogo.png")" style="max-width:150px; max-height:150px;" />
                                    }
                                </td>
                                <td style="text-align:justify; vertical-align:middle">
                                    <h4 style="text-align:left;">@Html.DisplayFor(modelItem => item.ItemName)<span> <small><b>(@Html.DisplayFor(modelItem => item.ItemCode))</b></small></span></h4>
                                    <hr />
                                    <h6>ITEM SPECIFICATIONS:</h6>
                                    <p style="text-align:justify; font-style:italic; font-size:12pt;">@Html.DisplayFor(modelItem => item.ItemSpecifications)</p>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Classification</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.Classification)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Item Type</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.ItemType)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Procurement Source</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.ProcurementSource)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Category</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.Category)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Unit of Measure</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.IndividualUOMReference)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Minimum Issuance Qty</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.MinimumIssuanceQty)<span>&nbsp;</span>@Html.DisplayFor(modelItem => item.IndividualUOMReference)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Unit Price</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @( item.ProcurementSource == "External Suppliers" ? "Subject to Market Survey by " + item.ResponsibilityCenter : String.Format("{0:C}", item.UnitCost) )
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Responsibility Center</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.ResponsibilityCenter)
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-3 col-sm-12" style="font-size: 10pt;">
                                                    <b>Purchase Request Office</b>
                                                </div>
                                                <div class="col-lg-9 col-md-9 col-sm-12" style="font-size: 10pt;">
                                                    <span>:</span> &nbsp; @Html.DisplayFor(modelItem => item.PurchaseRequestCenter)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align:right;">
                                        <button type="button" class="btn btn-sm btn-success" onclick="window.location = '@Url.Action("add-to-basket", "Catalogue", new { Area = "end-users", InventoryType = item.ItemType, ItemCode = item.ItemCode })'"><i class="fa fa-shopping-basket"></i> Add to Basket</button>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>
<hr />
<div class="row">
    <div class="col-sm-12">
        <div style="text-align: right;">
            <button type="button" class="btn btn-md btn-primary" onclick="window.location = '@Url.Action("view-basket", "Catalogue", new { Area = "end-users" })'"> <i class="fa fa-shopping-basket"></i> View Basket</button>
            <button type="button" class="btn btn-md btn-danger" onclick="window.location = '@Url.Action("project-details", "ProjectPlans", new { Area = "end-users", ProjectCode = ViewBag.ProjectCode })'"><i class="fa fa-arrow-alt-circle-left"></i> Back to Project Details</button>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $('#items').DataTable({
            "paging": true,
            "pageLength": 10,
            "lengthChange": false,
            "searching": false,
            "ordering": false,
            "info": true,
            "autoWidth": false,
        });
    });
</script>